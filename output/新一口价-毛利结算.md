# 画布: 画布 1

# 新一口价-毛利结算


## 后台设置

- 新增一口价规则/复制一口价规则
  - 渠道范围
    - 普通商户
    - ka商户
    - 普通用户
  - 生效时间
    - 可选择当前时间之后的时间
  - 人群选择
    - 全部人群
    - 北斗人群
    - 用户标签
      - 支持选择用户标签，支持多选，最多选3个
  - 订单品类
    - “渠道范围”为商户 展示商户品类
      - 复选框，默认为全选，可取消勾选全选，单独选择
      - 可多选
    - “渠道范围”为用户 展示用户品类
      - 复选框，默认为全选，可取消勾选全选，单独选择
      - 可多选
    - 切换“渠道范围”时订单品类随之切换
      - 已勾选的品类清空
  - 关联策略
    - 输入关键字查询“营销中心-智能营销-策略营销”下的一口价策略
      - 单选
    - 目前未区分营销策略的商户、用户是否对应，都能筛选出来
      - 让业务自己控制
      - 如果渠道选择商户，关联策略选择用户的策略
        - 该规则应该无法命中
  - 规则设置
    - 闪送员最终结算金额
      - MAX(订单原价 - 用户补贴金额 - (订单原价 × （目标毛利率+扣税比例）), 订单原价 × 兜底结算比例)，扣税比例可填入0-10以内一位小数的%；
    - 输入框
      - 扣税比例
        - 扣税比例可填入0-10以内一位小数的%
          - 扣税比例为0
          - 扣税比例为10
          - 扣税比例为3.3%
          - 不可输入3.33，-1，11
      - 里程区间
        - 左侧最小值为0，新增里程区间的左侧区间值为上一里程区间的最大值，区间范围左开右闭，可输入正整数，最大值为∞，最小值为0；
      - 目标毛利率
        - 为对应里程区间的目标毛利率，可配置指定区间的订单毛利率，可输入0-100之间的两位小数，包含0&100
        - 输入0
        - 输入100
        - 输入2.33，0.22，99.99
        - 不可输入 -1，3.455，101
      - 兜底佣金比例
        - 保证闪送员收入，当毛利公式计算的闪送员佣金过低时，则按照【订单穿透费用项*兜底结算比例】金额进行闪送员结算，可输入0-100之间的两位小数，不包含0&100
        - 可输入0.11，0.01，99.99
        - 可输入 3，70，90
        - 不可输入：0，100，-1，101，88.888
    - 操作项
      - 新增
        - 增加空白行可新增里程区间配置
      - 删除
        - 删除可删除对应里程区间配置
      - 操作项操作会联动里程区间变动
      - 最多可设置多少区间？
        - 最多10个区间
    - 展示
      - 区间补贴率
        - 取“关联策略”选择的策略对应的补贴规则
          - 前端这再加一个跳转链接能跳转到一口价规则配置页面查看
            - 有权限
              - 正常转跳
            - 无权限
              - 跳到首页
                - 营销中心也无权限
                  - 看下交互无异常
        - 补贴规则组合测试
          - 特惠结算规则设置0-5，5-10，10-∞
            - 补贴规则里程分段为0-5，5-10，10-20
              - 展示总补贴上限（百分比/固定值）
                - 都为百分比（1%-3%）
                  - 展示为：0-5：1%，5-10：2%，10-∞：3%
                    - ∞其实是大于等于20的？这时候展示10-∞比对补贴的10-20公里对吗？
                - 都为固定值（1元-3元）
                  - 展示为：0-5：1元，5-10：2元，10-∞：3元
                - 阶梯1、3为百分比，阶梯2为固定值
                  - 这种情况展示为 -？
            - 补贴规则里程分段为0-2，2-5，5-8，8-12，12-30
              - 都为百分比（0-2：1%，2-5：2%，5-8：3%，8-12：4%，12-30：5%）
                - 展示为：0-5：1%-2%，5-10：3%-4%，10-∞：4%-5%
              - 都为固定值（0-2：1元，2-5：2元，5-8：3元，8-12：4元，12-30：5元）
                - 展示为：0-5：1-2元，5-10：3-4元，10-∞：4-5元
              - 百分比固定值交叉（0-2：1%，2-5：1元，5-8：3%，8-12：2元，12-30：5%）
                - 展示 -
            - 一口价策略设置为abtest实验
              - 取A配置的补贴规则展示
      - 当前区间结算佣金比例
        - 取该城市“生效中”的“里程费”佣金比例
          - 所以城市变更规则，这个比例展示会变动
          - 如果里程费未配置动态抽拥，那么展示为 -
          - 存在待生效规则
            - 不取该数据
          - 存在生效中规则
          - 其他审核状态的规则（审核中）
            - 不取该数据
  - 定时生效/立即生效
    - 去掉
- 批量新增规则
- 历史一口价规则数据处理
  - 批量删除，不兼容历史数据
- 操作项
  - 查看
    - 展示该规则对应详情
  - 启用
    - 停用中规则可启用
      - 状态变为生效中
  - 停用
    - 生效中规则可停用
      - 状态变为停用中
  - 编辑
    - 生效中规则编辑
      - 新增一个规则ID，老的规则ID状态会变为已过期
    - 待生效规则编辑
      - 在该规则ID上进行编辑，不会新增id
    - 停用中规则编辑
      - 新增一个规则ID，老的规则ID状态仍然为停用中（如果老规则启用，那会2条都在生效中）
  - 复制
    - 会复制一个新的规则ID，不影响老的规则ID状态
  - 查看日志
    - 根据城市展示规则操作记录

## 计算

- 规则命中顺序
  - 按照城市、渠道、品类、策略、人群 匹配规则，取规则ID最新且“生效中”的规则命中
    - 人群>标签>全部
  - 如果都匹配不到，则不走一口价结算，那用户补贴还在
- 计算规则
  - 闪送员最终结算金额 = MAX(订单原价 - 用户补贴金额 - 订单原价 × (目标毛利率 + 3%), 订单原价 × 兜底结算比例)
    - 毛利税收结算金额 = 订单原价 - 用户补贴金额 - 订单原价 × (目标毛利率 + 3%)
兜底结算金额 = 订单原价 × 兜底结算比例
最终结算金额 = MAX(毛利税收结算金额, 兜底结算金额)
    - 订单原价为：里程费+重量费
  - 里程区间 (km)，目标毛利率，扣税比例，兜底结算比例
(0, 3]，5.00%，3%，45%
(3, 5]，8.00%，3%，55%
(5, 10]，12.00%，3%，60%
(10, ∞)，15.00%，3%，65%
    - 示例1：正常毛利税收结算
订单原价：30元
用户补贴：5元
订单里程：4km → 匹配规则：目标毛利率8%，扣税比例3%，兜底结算比例55%

计算过程：
毛利税收结算金额 = 30 - 5 - 30 × (8% + 3%) = 30 - 5 - 30 × 11% = 30 - 5 - 3.3 = 21.7元
兜底结算金额 = 30 × 55% = 16.5元
最终结算金额 = MAX(21.7, 16.5) = 21.7元

平台实际收入：30 - 5 - 21.7 = 3.3元（含税）
其中税收部分：30 × 3% = 0.9元
    - 示例2：接近兜底线的结算
订单原价：20元
用户补贴：8元
订单里程：2km → 匹配规则：目标毛利率5%，扣税比例3%，兜底结算比例45%

计算过程：
毛利税收结算金额 = 20 - 8 - 20 × (5% + 3%) = 20 - 8 - 20 × 8% = 20 - 8 - 1.6 = 10.4元
兜底结算金额 = 20 × 45% = 9元
最终结算金额 = MAX(10.4, 9) = 10.4元

平台实际收入：20 - 8 - 10.4 = 1.6元（含税）
其中税收部分：20 × 3% = 0.6元
    - 示例3：触发兜底结算
订单原价：15元
用户补贴：12元
订单里程：7km → 匹配规则：目标毛利率12%，扣税比例3%，兜底结算比例60%

计算过程：
毛利税收结算金额 = 15 - 12 - 15 × (12% + 3%) = 15 - 12 - 15 × 15% = 15 - 12 - 2.25 = 0.75元
兜底结算金额 = 15 × 60% = 9元
最终结算金额 = MAX(0.75, 9) = 9元

平台实际收入：15 - 12 - 9 = -6元（亏损）
其中税收部分：15 × 3% = 0.45元（理论上应收但实际未收到）
    - 示例4：高价值订单
订单原价：50元
用户补贴：10元
订单里程：12km → 匹配规则：目标毛利率15%，扣税比例3%，兜底结算比例65%

计算过程：
毛利税收结算金额 = 50 - 10 - 50 × (15% + 3%) = 50 - 10 - 50 × 18% = 50 - 10 - 9 = 31元
兜底结算金额 = 50 × 65% = 32.5元
最终结算金额 = MAX(31, 32.5) = 32.5元

平台实际收入：50 - 10 - 32.5 = 7.5元（含税）
其中税收部分：50 × 3% = 1.5元
- 续重
  - 订单续里程&续重量走常规订单命中的城市计费规则
    - 先确认下，和线上保持一致
  - 续重费用不按照毛利/兜底规则计算
- 续里程
  - 订单续里程&续重量走常规订单命中的城市计费规则
    - 先确认下，和线上保持一致
  - 续里程费用不按照毛利/兜底规则计算
    - 那里程费抽拥规则对吗？先确认下
- 其余费用项（按照动态抽拥规则抽拥），那结算规则要记录2个规则吧
  - 时段费
  - 跨江费
  - 交通费
  - 预约费
  - 上门费
  - 服务费
  - 增值服务费
  - 远程调度费
  - 偏远地区费
  - 密送服务费
    - 已下线
  - 帮买基础费
    - 回归正常即可
  - 帮买等候费
    - 回归正常即可
  - 小费
  - 溢价费

## 订单类型

- 一口价订单与尊享送订单互斥，且不进行抢单抽佣
  - 尊享送升舱是不是可以命中？
    - 产品要求尽量不命中尊享送升舱
- 帮买单
  - 营销策略不含帮买单，所以一口价也不含帮买单
- 命中一口价规则后
  - 里程、重量费走一口价结算规则
  - 其余费用按照动态抽佣走，且不再进行含自选偏好、惊喜单抽佣、抢派抽佣等附加抽佣规则
  - 配置下抢单抽拥
    - 一口价订单任何费用项都不叠加抢单抽拥
- 回归
  - 特惠单
  - 惊喜单
  - 计价调整
    - 原价（里程费+重量费）20，计价调整0.8，用户实际应支付16，优惠补贴5%，用户实际支付15.2。
订单原价（仅里程费+重量费）：16 
  - 闪送员端取价格优先级
    - 松鼠订单价格>尊享送+一口价（已经下线）>一口价>尊享送>自选偏好抽拥价格>普通价格。
    - 目前如果是用户自行购买尊享送，价格侧只会返回 QE价格。
    - 如果是免费升舱的订单，会在一口价价格和尊享送价格中增加惊喜单、基础抽拥的比例。所以免费升舱的订单不会命中自选偏好抽拥价格，也不会命中抢单抽拥，因为尊享送没有抢派之分，所以尊享送升舱订单也没有抢派之分。

---

**文件元信息**

- 文件名: 新一口价-毛利结算.xmind
- 文件大小: 1.32 MB
- 创建时间: 2025-10-14 21:23:16
- 修改时间: 2025-10-14 21:17:39